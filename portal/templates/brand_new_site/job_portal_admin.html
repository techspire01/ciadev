{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Internship Management</title>
    <link rel="stylesheet" href="{% static 'brand_new_site/css/admin-styles.css' %}">
    <!-- Apply site-wide font from settings (default: Times New Roman). -->
    <style>
        body, input, textarea, select, button { font-family:{ { SITE_FONT_FAMILY|default:"'Times New Roman', Times, serif" }}; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Mobile Menu Toggle -->
        <button class="mobile-menu-toggle" id="mobileMenuToggle">
            <span></span>
            <span></span>
            <span></span>
        </button>

        <!-- ==================== SIDEBAR ==================== -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="{% url 'index' %}" class="flex items-center space-x-2">
                    <img src="{% static 'images/CIA logo.png' %}" alt="CIA logo" class="h-10 rounded-lg logo-black-filter" />
                    <span class="text-2xl font-bold text-black">CIA<span class="text-yellow-700">next</span></span>
                </a>
            </div>
            <nav class="sidebar-nav">
                <li class="nav-item"><a class="nav-link active" onclick="switchTab('add-internships')">Add Internships</a></li>
                <li class="nav-item"><a class="nav-link" onclick="switchTab('view-internships')">View Internships</a></li>
                <li class="nav-item"><a class="nav-link" onclick="switchTab('add-jobs')">Add Jobs</a></li>
                <li class="nav-item"><a class="nav-link" onclick="switchTab('view-jobs')">View Jobs</a></li>
                <li class="nav-item"><a class="nav-link" onclick="switchTab('applications')">Applications</a></li>
            </nav>
        </aside>

        <!-- ==================== MAIN CONTENT ==================== -->
        <main class="main-content">
            <!-- ADD INTERNSHIPS TAB -->
            <div id="add-internships" class="tab-content active">
                <div class="page-header">
                    <h2>Add New Internship</h2>
                    <p>Create and manage internship opportunities</p>
                </div>
                <div class="form-container">
                    <form id="internship-form">
                        {% csrf_token %}
                        <h3>Internship Details</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Title</label>
                                <input type="text" name="title" placeholder="e.g., Software Engineer Intern" required>
                            </div>
                            <div class="form-group">
                                <label>Company Name</label>
                                <input type="text" name="company" placeholder="e.g., Tech Corp" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Duration</label>
                                <input type="text" name="duration" placeholder="e.g., 3-6 months" required>
                            </div>
                            <div class="form-group">
                                <label>Stipend</label>
                                <input type="text" name="stipend" placeholder="e.g., â‚¹20-25/hour" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" name="email" placeholder="contact@company.com" required>
                            </div>
                            <div class="form-group">
                                <label>Location</label>
                                <input type="text" name="location" placeholder="e.g., Mumbai, India" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Requirements</label>
                                <textarea name="requirements" placeholder="Skills required for the internship" rows="2"></textarea>
                            </div>
                        </div>
                        <div class="form-row-full">
                            <div class="form-group">
                                <label>Description</label>
                                <textarea name="description" placeholder="Describe the internship opportunity" rows="3" required></textarea>
                            </div>
                        </div>
                        <div class="form-row-full">
                            <div class="form-group">
                                <label>Responsibilities</label>
                                <textarea name="responsibilities" placeholder="Key responsibilities of the intern" rows="3"></textarea>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary btn-full">Add Internship</button>
                    </form>
                </div>
            </div>

            <!-- VIEW INTERNSHIPS TAB -->
            <div id="view-internships" class="tab-content">
                <div class="page-header">
                    <h2>Internship Listings</h2>
                    <p>Manage all internship opportunities</p>
                </div>
                <div id="internships-container" class="internships-container">
                    {% if internships %}
                        {% for internship in internships %}
                        <div class="opportunity-card">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">{{ internship.title|default:'N/A' }}</div>
                                    <div class="card-company">{{ internship.company_name|default:'N/A' }}</div>
                                </div>
                                <div class="card-status">
                                    {% if internship.is_active %}
                                        <span class="status-active">Active</span>
                                    {% else %}
                                        <span class="status-inactive">Inactive</span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="card-details">
                                <p><strong>Duration:</strong> {{ internship.duration|default:'N/A' }}</p>
                                <p><strong>Stipend:</strong> {{ internship.salary|default:'N/A' }}</p>
                                <p><strong>Location:</strong> {{ internship.location|default:'N/A' }}</p>
                                <p><strong>Email:</strong> {{ internship.email|default:'N/A' }}</p>
                                <p><strong>Posted Date:</strong> {{ internship.posted_date|default:'N/A' }}</p>
                                <p><strong>Description:</strong> {{ internship.description|default:'N/A' }}</p>
                                <p><strong>Requirements:</strong> {{ internship.requirements|default:'N/A' }}</p>
                                <p><strong>Responsibilities:</strong> {{ internship.responsibilities|default:'N/A' }}</p>
                            </div>
                            <div class="card-details" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #e5e7eb;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                                    <span style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 6px 14px; border-radius: 20px; font-size: 14px; font-weight: 600;">
                                        ðŸ‘¥ {{ internship.application_count|default:0 }} Applications
                                    </span>
                                    <a href="{% url 'view_internship_applicants' internship_id=internship.id %}" 
                                       class="btn btn-primary btn-small"
                                       style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; text-decoration: none; padding: 6px 14px; border-radius: 6px; font-size: 13px; font-weight: 600;">
                                       View Applicants â†’
                                    </a>
                                </div>
                            </div>

                            <div class="card-actions">
                                <!-- Edit Button -->
                                <button class="btn btn-primary btn-small"
                                        onclick="openEditModal('{{ internship.id }}',
                                                       '{{ internship.title }}',
                                                       '{{ internship.company_name }}',
                                                       '{{ internship.duration }}',
                                                       '{{ internship.salary }}',
                                                       '{{ internship.email }}',
                                                       '{{ internship.location }}',
                                                       `{{ internship.description|escapejs }}`,
                                                       `{{ internship.requirements|escapejs }}`,
                                                       `{{ internship.responsibilities|escapejs }}`)">
                                    Edit
                                </button>

                                <!-- Pause / Resume -->
                                {% if internship.is_active %}
                                    <a href="{% url 'toggle_internship' internship.id %}"
                                       class="btn btn-warning btn-small"
                                       style="background:#f59e0b;color:white;">
                                       Pause
                                    </a>
                                {% else %}
                                    <a href="{% url 'toggle_internship' internship.id %}"
                                       class="btn btn-success btn-small"
                                       style="background:#10b981;color:white;">
                                       Resume
                                    </a>
                                {% endif %}

                                <!-- Delete -->
                                <a href="{% url 'delete_internship' internship.id %}"
                                   class="btn btn-danger btn-small"
                                   onclick="return confirm('Are you sure you want to delete this internship?');">
                                   Delete
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-state" id="empty-internships">
                            <div class="icon">ðŸ“‹</div>
                            <h3>No internships yet</h3>
                            <p>Add your first internship opportunity from the "Add Internships" tab</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- ADD JOBS TAB -->
            <div id="add-jobs" class="tab-content">
                <div class="page-header">
                    <h2>Add New Job</h2>
                    <p>Create and manage job opportunities</p>
                </div>
                <div class="form-container">
                    <form id="job-form">
                        {% csrf_token %}
                        <h3>Job Details</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Job Title</label>
                                <input type="text" name="title" placeholder="e.g., Senior Software Engineer" required>
                            </div>
                            <div class="form-group">
                                <label>Company Name</label>
                                <input type="text" name="company" placeholder="e.g., Tech Corp" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Location</label>
                                <input type="text" name="location" placeholder="e.g., Mumbai, India" required>
                            </div>
                            <div class="form-group">
                                <label>Salary</label>
                                <input type="text" name="salary" placeholder="e.g., â‚¹12-15 LPA" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" name="email" placeholder="contact@company.com" required>
                            </div>
                            <div class="form-group">
                                <label>Experience</label>
                                <input type="text" name="experience" placeholder="e.g., 2-3 years">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Requirements</label>
                                <textarea name="requirements" placeholder="Skills required for the job" rows="2"></textarea>
                            </div>
                        </div>
                        <div class="form-row-full">
                            <div class="form-group">
                                <label>Description</label>
                                <textarea name="description" placeholder="Describe the job opportunity" rows="3" required></textarea>
                            </div>
                        </div>
                        <div class="form-row-full">
                            <div class="form-group">
                                <label>Responsibilities</label>
                                <textarea name="responsibilities" placeholder="Key responsibilities of the role" rows="3"></textarea>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary btn-full">Add Job</button>
                    </form>
                </div>
            </div>

            <!-- ==================== VIEW JOBS TAB ==================== -->
            <div id="view-jobs" class="tab-content">
                <div class="page-header">
                    <h2>Job Listings</h2>
                    <p>Manage all job opportunities</p>
                </div>

                <div class="filter-bar">
                    <input type="text" id="job-search" class="search-input" placeholder="Search job title...">

                    <select id="job-status-filter" class="filter-select">
                        <option value="all">All</option>
                        <option value="active">Active Only</option>
                        <option value="inactive">Inactive Only</option>
                    </select>
                </div>

                <div id="jobs-container" class="internships-container">
                    {% if jobs %}
                        {% for job in jobs %}
                        <div class="opportunity-card"
                             data-title="{{ job.title|lower }}"
                             data-status="{% if job.is_active %}active{% else %}inactive{% endif %}">
                            <div class="card-header">
                                <div>
                                    <div class="card-title">{{ job.title|default:'N/A' }}</div>
                                    <div class="card-company">{{ job.company_name|default:'N/A' }}</div>
                                </div>
                                <div class="card-status">
                                    {% if job.is_active %}
                                        <span class="status-active">Active</span>
                                    {% else %}
                                        <span class="status-inactive">Inactive</span>
                                    {% endif %}
                                </div>
                            </div>

                            <div class="card-details" style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #e5e7eb;">
                                <p><strong>Location:</strong> {{ job.location|default:'N/A' }}</p>
                                <p><strong>Salary:</strong> {{ job.salary|default:'N/A' }}</p>
                                <p><strong>Experience:</strong> {{ job.experience|default:'N/A' }}</p>
                                <p><strong>Email:</strong> {{ job.email|default:'N/A' }}</p>
                                <p><strong>Posted Date:</strong> {{ job.posted_date|default:'N/A' }}</p>
                                <p><strong>Description:</strong> {{ job.description|default:'N/A' }}</p>
                                <p><strong>Requirements:</strong> {{ job.requirements|default:'N/A' }}</p>
                                <p><strong>Responsibilities:</strong> {{ job.responsibilities|default:'N/A' }}</p>
                                
                                <div style="display: flex; align-items: center; gap: 10px; margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb;">
                                    <span style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; padding: 6px 14px; border-radius: 20px; font-size: 14px; font-weight: 600;">
                                        ðŸ‘¥ {{ job.application_count|default:0 }} Applications
                                    </span>
                                    <a href="{% url 'view_job_applicants' job_id=job.id %}" 
                                       class="btn btn-primary btn-small"
                                       style="background: linear-gradient(135deg, #f59e0b, #d97706); color: white; text-decoration: none; padding: 6px 14px; border-radius: 6px; font-size: 13px; font-weight: 600;">
                                       View Applicants â†’
                                    </a>
                                </div>
                            </div>

                            <div class="card-actions">
                                <!-- Edit Job Button -->
                                <button class="btn btn-primary btn-small"
                                    onclick="openEditJobModal('{{ job.id }}',
                                                      '{{ job.title }}',
                                                      '{{ job.company_name }}',
                                                      '{{ job.location }}',
                                                      '{{ job.salary }}',
                                                      '{{ job.email }}',
                                                      `{{ job.description|escapejs }}`,
                                                      `{{ job.requirements|escapejs }}`,
                                                      `{{ job.responsibilities|escapejs }}`,
                                                      '{{ job.experience }}')">
                                    Edit
                                </button>

                                <!-- Pause / Resume -->
                                {% if job.is_active %}
                                    <a href="{% url 'toggle_job' job.id %}"
                                       class="btn btn-warning btn-small"
                                       style="background:#f59e0b;color:white;">
                                       Pause
                                    </a>
                                {% else %}
                                    <a href="{% url 'toggle_job' job.id %}"
                                       class="btn btn-success btn-small"
                                       style="background:#10b981;color:white;">
                                       Resume
                                    </a>
                                {% endif %}

                                <!-- Delete -->
                                <a href="{% url 'delete_job_view' job.id %}"
                                   class="btn btn-danger btn-small"
                                   onclick="return confirm('Are you sure you want to delete this job?');">
                                   Delete
                                </a>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div class="empty-state" id="empty-jobs">
                            <div class="icon">ðŸ’¼</div>
                            <h3>No jobs yet</h3>
                            <p>Add your first job opportunity from the "Add Jobs" tab</p>
                        </div>
                    {% endif %}
                </div>
            </div>

            <!-- APPLICATIONS TAB -->
            <div id="applications" class="tab-content">
                <div class="page-header">
                    <h2>Applications</h2>
                    <p>View and manage all applications</p>
                </div>
                <div class="table-container">
                    <table id="applications-table">
                        <thead>
                            <tr>
                                <th>Applicant Name</th>
                                <th>Email</th>
                                <th>Applied For</th>
                                <th>Date</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Applications will be rendered here -->
                        </tbody>
                    </table>
                </div>
                <div class="empty-state" id="empty-applications">
                    <div class="icon">ðŸ“§</div>
                    <h3>No applications yet</h3>
                    <p>Applications will appear here once received</p>
                </div>
            </div>
        </main>
    </div>

    <!-- ==================== EDIT MODAL ==================== -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Internship</h3>
                <button class="modal-close" onclick="document.getElementById('edit-modal').classList.remove('active')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-form" method="POST" action="" style="max-height:60vh;overflow-y:auto;">
                    {% csrf_token %}
                    <input type="hidden" id="edit-id" name="id">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Title</label>
                            <input type="text" id="edit-title" name="title" required>
                        </div>
                        <div class="form-group">
                            <label>Company</label>
                            <input type="text" id="edit-company" name="company" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Duration</label>
                            <input type="text" id="edit-duration" name="duration" required>
                        </div>
                        <div class="form-group">
                            <label>Stipend</label>
                            <input type="text" id="edit-stipend" name="stipend" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="edit-email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label>Location</label>
                            <input type="text" id="edit-location" name="location" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Requirements</label>
                            <textarea id="edit-requirements" name="requirements" rows="2"></textarea>
                        </div>
                    </div>
                    <div class="form-row-full">
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="edit-description" name="description" rows="3" required></textarea>
                        </div>
                    </div>
                    <div class="form-row-full">
                        <div class="form-group">
                            <label>Responsibilities</label>
                            <textarea id="edit-responsibilities" name="responsibilities" rows="3"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer" style="display:flex;gap:0.5rem;justify-content:flex-end;">
                <button type="button" class="btn btn-secondary btn-small" onclick="closeEditModal()">Cancel</button>
                <button type="button" class="btn btn-primary btn-small" onclick="submitEditForm()">Save Changes</button>
            </div>
            </div>
            <!-- Modal footer moved inside form for better UX -->
        </div>
    </div>

    <!-- ==================== EDIT JOB MODAL ==================== -->
    <div id="edit-job-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Job</h3>
                <button class="modal-close" onclick="document.getElementById('edit-job-modal').classList.remove('active')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="edit-job-form" method="POST" action="" style="max-height:60vh;overflow-y:auto;">
                    {% csrf_token %}
                    <input type="hidden" id="edit-job-id" name="id">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Job Title</label>
                            <input type="text" id="edit-job-title" name="title" required>
                        </div>
                        <div class="form-group">
                            <label>Company</label>
                            <input type="text" id="edit-job-company" name="company" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Location</label>
                            <input type="text" id="edit-job-location" name="location" required>
                        </div>
                        <div class="form-group">
                            <label>Salary</label>
                            <input type="text" id="edit-job-salary" name="salary" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Email</label>
                            <input type="email" id="edit-job-email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label>Experience</label>
                            <input type="text" id="edit-job-experience" name="experience" placeholder="e.g., 2-3 years">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Requirements</label>
                            <textarea id="edit-job-requirements" name="requirements" rows="2"></textarea>
                        </div>
                    </div>
                    <div class="form-row-full">
                        <div class="form-group">
                            <label>Description</label>
                            <textarea id="edit-job-description" name="description" rows="3" required></textarea>
                        </div>
                    </div>
                    <div class="form-row-full">
                        <div class="form-group">
                            <label>Responsibilities</label>
                            <textarea id="edit-job-responsibilities" name="responsibilities" rows="3"></textarea>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer" style="display:flex;gap:0.5rem;justify-content:flex-end;">
                <button type="button" class="btn btn-secondary btn-small" onclick="closeEditJobModal()">Cancel</button>
                <button type="button" class="btn btn-primary btn-small" onclick="submitEditJobForm()">Save Changes</button>
            </div>
            </div>
            <!-- Modal footer moved inside form for better UX -->
        </div>
    </div>

    <script src="{% static 'brand_new_site/js/admin.js' %}"></script>
</body>
</html>
