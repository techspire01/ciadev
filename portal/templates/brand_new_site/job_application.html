{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
    /* Popup Modal Styles */
    .popup-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .popup-box {
      background: #fff;
      border-radius: 20px;
      padding: 40px 50px;
      text-align: center;
      box-shadow: 0 10px 40px rgba(0,0,0,0.25);
      max-width: 400px;
      animation: slideUp 0.3s ease;
    }
    @keyframes slideUp {
      from { transform: translateY(30px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    .popup-box.success {
      border-top: 5px solid #22c55e;
    }
    .popup-box.error {
      border-top: 5px solid #ef4444;
    }
    .popup-icon {
      font-size: 3rem;
      margin-bottom: 15px;
    }
    .popup-box.success .popup-icon { color: #22c55e; }
    .popup-box.error .popup-icon { color: #ef4444; }
    .popup-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: #204b6e;
      margin-bottom: 10px;
    }
    .popup-message {
      font-size: 1.05rem;
      color: #555;
      margin-bottom: 20px;
    }
    .popup-close-btn {
      background: linear-gradient(90deg, #F59E0B, #D97706);
      color: #fff;
      border: none;
      padding: 12px 30px;
      border-radius: 12px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }
    .popup-close-btn:hover {
      transform: scale(1.05);
    }

    :root {
      --blue: #F59E0B;
      --red: #D97706;
      --gold: #FCD34D;
      --dark: #78350F;
      --white: #FFFFFF;
      --light-bg: #FFFBF0;
      --gray: #92400E;
      --shadow: 0 8px 20px rgba(245,158,11,0.1);
      --shadow-lg: 0 12px 30px rgba(245,158,11,0.15);
    }

    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Times New Roman', Times, serif;
      background: #FFFBF0;
      color: var(--dark);
      overflow-x: hidden;
      position: relative;
    }

    /* Industrial Background Video */
    .bg-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background: #FFFBF0;
      overflow: hidden;
    }

    .bg-video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: center;
      opacity: 0.3;
    }

    .bg-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(180deg, rgba(255, 251, 240, 0.7) 0%, rgba(255, 245, 230, 0.6) 50%, rgba(255, 251, 240, 0.8) 100%);
      pointer-events: none;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      25% { transform: translateY(-10px); }
      50% { transform: translateY(-5px); }
      75% { transform: translateY(-8px); }
    }

    /* New Keyframe Animation: Hero Title Entrance */
    @keyframes fadeInDown {
      0% {
        opacity: 0;
        transform: translateY(-30px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* New Keyframe Animation: Fade In and Slide Up */
    @keyframes fadeInSlideUp {
      0% {
        opacity: 0;
        transform: translateY(30px);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .parallax-layer {
      position: absolute;
      width: 100%;
      height: 100%;
    }

    .particle {
      position: absolute;
      background: var(--blue);
      border-radius: 50%;
      animation: particle-float 4s ease-in-out infinite;
    }

    .particle:nth-child(1) { width: 8px; height: 8px; top: 10%; left: 20%; animation-delay: 0s; }
    .particle:nth-child(2) { width: 12px; height: 12px; top: 30%; left: 60%; animation-delay: 1s; }
    .particle:nth-child(3) { width: 6px; height: 6px; top: 50%; left: 80%; animation-delay: 2s; }
    .particle:nth-child(4) { width: 10px; height: 10px; top: 70%; left: 30%; animation-delay: 1.5s; }
    .particle:nth-child(5) { width: 8px; height: 8px; top: 20%; left: 90%; animation-delay: 0.5s; }

    @keyframes particle-float {
      0%, 100% { transform: translateY(0) translateX(0); }
      50% { transform: translateY(-20px) translateX(10px); }
    }

    /* Main content wrapper */
    .application-wrapper {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* Header/Navigation */
    .application-header {
      background: rgba(255, 251, 240, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(245, 158, 11, 0.1);
      padding: 2px 4px;
      box-shadow: var(--shadow);
    }

    .header-content {
      max-width: 1400px;
      width: 100%;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 2px;
      box-sizing: border-box;
    }

    .header-branding {
      display: flex;
      align-items: center;
      gap: 1.5px;
    }

    .header-logo {
      width: 5px;
      height: 5px;
      border-radius: 50%;
      background: linear-gradient(135deg, var(--blue), var(--red));
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: white;
      font-size: 2.4px;
    }

    .header-logo img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
    }

    .header-title {
      font-size: 2.4px;
      font-weight: 700;
      color: var(--dark);
      margin: 0;
    }

    .header-subtitle {
      font-size: 1.2px;
      color: var(--gray);
      margin: 0;
      font-weight: 500;
    }

    .header-nav {
      display: flex;
      gap: 2px;
    }

    .nav-link {
      color: var(--dark);
      text-decoration: none;
      font-weight: 600;
      transition: color 0.3s ease;
      font-size: 2px;
    }

    .nav-link:hover {
      color: var(--blue);
    }

    /* Main content area */
    .application-main {
      flex: 1;
      max-width: 800px;
      width: 100%;
      margin: 0 auto;
      padding: 60px 40px;
      display: flex;
      flex-direction: column;
      box-sizing: border-box;
      align-items: center;
    }

    /* Hero section */
    .hero-section {
      margin-bottom: 50px;
      animation: fadeInDown 0.8s ease;
      width: 100%;
      text-align: center;
    }

    .hero-title {
      font-size: 48px;
      font-weight: 700;
      color: var(--dark);
      margin: 0 auto 10px auto;
      background: linear-gradient(135deg, var(--dark), var(--gray));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      word-wrap: break-word;
      overflow-wrap: break-word;
      hyphens: auto;
    }

    .hero-subtitle {
      font-size: 16px;
      color: var(--gray);
      margin: 0 auto;
      max-width: 600px;
      line-height: 1.6;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    /* Application form */
    .application-form {
      background: white;
      border-radius: 15px;
      padding: 40px;
      box-shadow: var(--shadow);
      width: 100%;
      animation: fadeInSlideUp 0.8s ease 0.2s both;
    }

    .form-section {
      margin-bottom: 30px;
    }

    .form-section:last-child {
      margin-bottom: 0;
    }

    .form-title {
      font-size: 20px;
      font-weight: 700;
      color: var(--dark);
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .form-title svg {
      width: 24px;
      height: 24px;
      stroke: var(--blue);
      stroke-width: 2;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group:last-child {
      margin-bottom: 0;
    }

    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: var(--dark);
      margin-bottom: 8px;
    }

    .form-input,
    .form-textarea,
    .form-select {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid rgba(245, 158, 11, 0.2);
      border-radius: 8px;
      font-size: 14px;
      color: var(--dark);
      background: white;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }

    .form-input:focus,
    .form-textarea:focus,
    .form-select:focus {
      outline: none;
      border-color: var(--blue);
      box-shadow: var(--shadow);
    }

    .form-textarea {
      resize: vertical;
      min-height: 120px;
    }

    .form-file {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid rgba(245, 158, 11, 0.2);
      border-radius: 8px;
      background: white;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }

    .form-file:focus {
      outline: none;
      border-color: var(--blue);
      box-shadow: var(--shadow);
    }

    .file-input-label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: var(--dark);
      margin-bottom: 8px;
    }

    .file-input-wrapper {
      position: relative;
      display: inline-block;
      width: 100%;
    }

    .file-input-wrapper input[type="file"] {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }

    .file-input-button {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      padding: 12px 16px;
      border: 2px solid rgba(245, 158, 11, 0.2);
      border-radius: 8px;
      background: white;
      color: var(--gray);
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      box-sizing: border-box;
    }

    .file-input-button:hover {
      border-color: var(--blue);
      background: rgba(245, 158, 11, 0.05);
      color: var(--blue);
    }

    .file-input-button svg {
      width: 20px;
      height: 20px;
      stroke: currentColor;
      stroke-width: 2;
    }

    .form-actions {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 30px;
    }

    .btn {
      padding: 12px 30px;
      border: 2px solid var(--blue);
      background: white;
      color: var(--blue);
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .btn:hover {
      background: rgba(245, 158, 11, 0.05);
      transform: translateY(-2px);
    }

    .btn.primary {
      background: var(--blue);
      color: white;
      border-color: var(--blue);
    }

    .btn.primary:hover {
      background: var(--red);
      border-color: var(--red);
      transform: translateY(-2px);
    }

    /* Footer */
    .application-footer {
      background: rgba(255, 251, 240, 0.95);
      border-top: 2px solid rgba(245, 158, 11, 0.1);
      padding: 30px 40px;
      text-align: center;
      font-size: 14px;
      color: var(--gray);
    }

    /* Responsive */
    @media (max-width: 768px) {
      .application-main {
        padding: 40px 20px;
      }

      .application-form {
        padding: 30px 20px;
      }

      .hero-title {
        font-size: 36px;
      }

      .form-actions {
        flex-direction: column;
      }

      .btn {
        width: 100%;
      }
    }

    @media (max-width: 640px) {
      .application-header {
        padding: 1.5px 2px;
      }

      .header-content {
        flex-wrap: wrap;
        gap: 1.5px;
      }

      .header-nav {
        gap: 1.5px;
      }

      .application-main {
        padding: 30px 15px;
      }

      .hero-title {
        font-size: 28px;
      }

      .application-form {
        padding: 20px 15px;
      }
    }
  </style>

{% if user.is_authenticated %}

<div class="bg-container">
    <video autoplay muted loop playsinline class="bg-video">
      <source src="{% static 'brand_new_site/videos/background.mp4' %}" type="video/mp4">
    </video>
    <div class="bg-overlay"></div>
    <div class="parallax-layer" id="parallaxLayer">
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
      <div class="particle"></div>
    </div>
  </div>
    </header>

    <main class="application-main">
      <section class="hero-section">
        <h1 class="hero-title">Job Application</h1>
        <p class="hero-subtitle">Apply for exciting job opportunities and take the next step in your career.</p>
      </section>

      <form class="application-form" method="post" enctype="multipart/form-data" id="applicationForm">
        {% csrf_token %}

        <!-- SECTION 1: BASIC DETAILS -->
        <div class="form-section">
          <h2 class="form-title">
            <svg viewBox="0 0 24 24" fill="none"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            1. Basic Details
          </h2>

          <div class="form-group">
            <label for="{{ form.first_name.id_for_label }}" class="form-label">First Name *</label>
            {{ form.first_name }}
            {% if form.first_name.errors %}<div style="color: red;">{{ form.first_name.errors }}</div>{% endif %}
          </div>

          <div class="form-group">
            <label for="{{ form.last_name.id_for_label }}" class="form-label">Last Name *</label>
            {{ form.last_name }}
            {% if form.last_name.errors %}<div style="color: red;">{{ form.last_name.errors }}</div>{% endif %}
          </div>

          <div class="form-group">
            <label for="{{ form.phone.id_for_label }}" class="form-label">Phone Number *</label>
            {{ form.phone }}
            {% if form.phone.errors %}<div style="color: red;">{{ form.phone.errors }}</div>{% endif %}
          </div>

          <div class="form-group">
            <label for="{{ form.email.id_for_label }}" class="form-label">Email Address *</label>
            {{ form.email }}
            {% if form.email.errors %}<div style="color: red;">{{ form.email.errors }}</div>{% endif %}
          </div>

          <div class="form-group">
            <label for="{{ form.address.id_for_label }}" class="form-label">Address</label>
            {{ form.address }}
          </div>

          <div class="form-group">
            <label for="{{ form.city.id_for_label }}" class="form-label">City</label>
            {{ form.city }}
          </div>

          <div class="form-group">
            <label for="{{ form.state.id_for_label }}" class="form-label">State</label>
            {{ form.state }}
          </div>

          <div class="form-group">
            <label for="{{ form.country.id_for_label }}" class="form-label">Country</label>
            {{ form.country }}
          </div>
        </div>

        <!-- SECTION 2: RESUME UPLOAD -->
        <div class="form-section">
          <h2 class="form-title">
            <svg viewBox="0 0 24 24" fill="none"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg>
            2. Resume Upload
          </h2>

          <div class="form-group">
            <label class="file-input-label">Upload Resume *</label>
            <div class="file-input-wrapper">
              {{ form.resume }}
              <div class="file-input-button">
                <svg viewBox="0 0 24 24" fill="none"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10,9 9,9 8,9"/></svg>
                Choose Resume File
              </div>
            </div>
            <small style="display: block; margin-top: 8px; color: var(--gray);">{{ form.resume.help_text }}</small>
            {% if form.resume.errors %}<div style="color: red;">{{ form.resume.errors }}</div>{% endif %}
          </div>
        </div>

        <!-- SECTION 3: EXPERIENCE STATUS -->
        <div class="form-section">
          <h2 class="form-title">
            <svg viewBox="0 0 24 24" fill="none"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            3. Experience Status
          </h2>

          <div class="form-group">
            <label class="form-label">{{ form.status.label }} *</label>
            <div style="display: flex; gap: 2rem; margin: 1rem 0;">
              {% for radio in form.status %}
                <div style="display: flex; align-items: center;">
                  {{ radio.tag }}
                  <label class="form-label" for="{{ radio.id_for_label }}" style="margin-bottom: 0; margin-left: 8px;">
                    {{ radio.choice_label }}
                  </label>
                </div>
              {% endfor %}
            </div>
            {% if form.status.errors %}<div style="color: red;">{{ form.status.errors }}</div>{% endif %}
          </div>
        </div>

        <!-- SECTION 4: EDUCATION DETAILS -->
        <div class="form-section">
          <h2 class="form-title">
            <svg viewBox="0 0 24 24" fill="none"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10,9 9,9 8,9"/></svg>
            4. Education Details
          </h2>

          <div class="form-group">
            <label for="{{ form.school_name.id_for_label }}" class="form-label">{{ form.school_name.label }} *</label>
            {{ form.school_name }}
            {% if form.school_name.errors %}<div style="color: red;">{{ form.school_name.errors }}</div>{% endif %}
          </div>

          <div class="form-group">
            <label for="{{ form.city_of_study.id_for_label }}" class="form-label">{{ form.city_of_study.label }} *</label>
            {{ form.city_of_study }}
            {% if form.city_of_study.errors %}<div style="color: red;">{{ form.city_of_study.errors }}</div>{% endif %}
          </div>

          <div class="form-group">
            <label for="{{ form.degree.id_for_label }}" class="form-label">{{ form.degree.label }} *</label>
            {{ form.degree }}
            {% if form.degree.errors %}<div style="color: red;">{{ form.degree.errors }}</div>{% endif %}
          </div>

          <div class="form-group">
            <label for="{{ form.field_of_study.id_for_label }}" class="form-label">{{ form.field_of_study.label }} *</label>
            {{ form.field_of_study }}
            {% if form.field_of_study.errors %}<div style="color: red;">{{ form.field_of_study.errors }}</div>{% endif %}
          </div>

          <div class="form-group">
            <label for="{{ form.study_from_date.id_for_label }}" class="form-label">{{ form.study_from_date.label }} *</label>
            {{ form.study_from_date }}
            {% if form.study_from_date.errors %}<div style="color: red;">{{ form.study_from_date.errors }}</div>{% endif %}
          </div>

          <div class="form-group">
            <label for="{{ form.study_to_date.id_for_label }}" class="form-label">{{ form.study_to_date.label }}</label>
            {{ form.study_to_date }}
            {% if form.study_to_date.errors %}<div style="color: red;">{{ form.study_to_date.errors }}</div>{% endif %}
          </div>

          <div style="display: flex; align-items: center; margin-bottom: 1rem;">
            {{ form.currently_studying }}
            <label class="form-label" for="{{ form.currently_studying.id_for_label }}" style="margin-bottom: 0; margin-left: 8px;">
              {{ form.currently_studying.label }}
            </label>
          </div>
        </div>

        <!-- SECTION 5: WORK EXPERIENCE (Conditional for Experienced) -->
        <div class="form-section" id="work-experience-section" style="display: none;">
          <h2 class="form-title">
            <svg viewBox="0 0 24 24" fill="none"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            5. Work Experience
          </h2>

          <div id="work-entries-container"></div>
          <button type="button" id="add-work-entry" class="btn" style="margin-top: 1rem;">Add Work Experience</button>
          
          <input type="hidden" id="work_experiences_json" name="work_experiences_json" value="[]">
        </div>

        <!-- SECTION 6: SKILLS -->
        <div class="form-section">
          <h2 class="form-title">
            <svg viewBox="0 0 24 24" fill="none"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            6. Skills
          </h2>

          <div class="form-group">
            <label for="{{ form.skills.id_for_label }}" class="form-label">{{ form.skills.label }}</label>
            {{ form.skills }}
            <small style="display: block; margin-top: 8px; color: var(--gray);">{{ form.skills.help_text }}</small>
          </div>
        </div>

        <!-- SECTION 7: LINKEDIN PROFILE -->
        <div class="form-section">
          <h2 class="form-title">
            <svg viewBox="0 0 24 24" fill="none"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
            7. LinkedIn Profile
          </h2>

          <div class="form-group">
            <label for="{{ form.linkedin_profile.id_for_label }}" class="form-label">{{ form.linkedin_profile.label }}</label>
            {{ form.linkedin_profile }}
          </div>
        </div>

        <!-- SECTION 8: SCREENING QUESTIONS -->
        <div class="form-section">
          <h2 class="form-title">
            <svg viewBox="0 0 24 24" fill="none"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg>
            8. Screening Questions
          </h2>

          <div class="form-group">
            <label for="{{ form.screening_questions.id_for_label }}" class="form-label">{{ form.screening_questions.label }}</label>
            {{ form.screening_questions }}
            <small style="display: block; margin-top: 8px; color: var(--gray);">0-2000 characters</small>
          </div>
        </div>

        <!-- SECTION 9: MESSAGE TO HIRING MANAGER -->
        <div class="form-section">
          <h2 class="form-title">
            <svg viewBox="0 0 24 24" fill="none"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg>
            9. Message to Hiring Manager
          </h2>

          <div class="form-group">
            <label for="{{ form.message_to_manager.id_for_label }}" class="form-label">{{ form.message_to_manager.label }}</label>
            {{ form.message_to_manager }}
            <small style="display: block; margin-top: 8px; color: var(--gray);">0-2000 characters</small>
          </div>
        </div>

        <!-- SECTION 10: ADDITIONAL ATTACHMENTS -->
        <div class="form-section">
          <h2 class="form-title">
            <svg viewBox="0 0 24 24" fill="none"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/></svg>
            10. Additional Attachments (Optional)
          </h2>

          <div class="form-group">
            <label class="file-input-label">{{ form.additional_attachment.label }}</label>
            <div class="file-input-wrapper">
              {{ form.additional_attachment }}
              <div class="file-input-button">
                <svg viewBox="0 0 24 24" fill="none"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10,9 9,9 8,9"/></svg>
                Choose File
              </div>
            </div>
            <small style="display: block; margin-top: 8px; color: var(--gray);">{{ form.additional_attachment.help_text }}</small>
          </div>
        </div>

        <div class="form-actions">
          <button type="button" class="btn" onclick="window.history.back()">Cancel</button>
          <button type="submit" class="btn primary">Submit Application</button>
        </div>
      </form>
    </main>

    {% else %}
    <!-- Login Required Modal Overlay (for unauthenticated users) -->
    <div id="login-overlay" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm">
      <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 text-center relative" style="background: linear-gradient(135deg, #f59e0b 0%, #f97316 50%, #ea580c 100%); color: white;">
        <button id="close-popup" type="button" class="absolute top-4 right-4 text-white hover:text-gray-200 transition-colors cursor-pointer bg-white/10 rounded-full w-8 h-8 flex items-center justify-center hover:bg-white/20" title="Close">
          <i class="fas fa-times text-xl"></i>
        </button>
        <div class="mb-4">
          <i class="fas fa-lock text-6xl opacity-90" style="animation: bounce 2s infinite;"></i>
        </div>
        <h2 class="text-2xl font-bold mb-4">Access Restricted</h2>
        <p class="text-lg mb-6 leading-relaxed">Please login to apply for jobs.</p>
        <a href="{% url 'login' %}" id="login-btn" class="inline-flex items-center justify-center bg-white text-orange-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 hover:text-orange-700 transition-all duration-300 shadow-lg cursor-pointer w-full">
          <i class="fas fa-sign-in-alt mr-2"></i>Login Now
        </a>
      </div>
    </div>
    {% endif %}

    <footer class="application-footer">
      <p>&copy; 2025 CIA Incubation Cell. All rights reserved.</p>
    </footer>
  </div>

  <script>
    // Popup functions (use the announcement-style persistent modal)
    function closePopup() {
      var overlay = document.getElementById('popup-overlay');
      if (overlay) overlay.remove();
    }

    function showPopup(isSuccess, message) {
      var existing = document.getElementById('popup-overlay');
      if (existing) existing.remove();

      var overlay = document.createElement('div');
      overlay.id = 'popup-overlay';
      overlay.style.position = 'fixed';
      overlay.style.inset = '0';
      overlay.style.display = 'flex';
      overlay.style.alignItems = 'center';
      overlay.style.justifyContent = 'center';
      overlay.style.background = 'rgba(0,0,0,0.45)';
      overlay.style.zIndex = '99999';
      overlay.innerHTML = `
        <div style="width: 100%; max-width: 480px; margin: 0 16px; position: relative;">
          <div style="background: linear-gradient(135deg, #fff 0%, #fff 100%); border-radius: 20px; padding: 28px; box-shadow: 0 20px 50px rgba(0,0,0,0.25); text-align: center; position: relative;">
            <button id="popup-close-x" style="position: absolute; top: 12px; right: 12px; width:36px; height:36px; border-radius:999px; background: rgba(0,0,0,0.06); border:none; cursor:pointer;">
              <i class="fas fa-times" style="color:#333;"></i>
            </button>
            <div style="font-size:44px; color:${isSuccess ? '#10b981' : '#ef4444'}; margin-bottom:12px;">${isSuccess ? '\u2714' : '\u2716'}</div>
            <h3 style="font-size:20px; font-weight:700; margin-bottom:8px;">${isSuccess ? 'Application Submitted' : 'Submission Failed'}</h3>
            <p style="color:#444; margin-bottom:18px;">${message}</p>
            <div style="display:flex; gap:12px; justify-content:center;">
              <button id="popup-ok-btn" style="background: linear-gradient(90deg, #F59E0B, #D97706); color: white; border: none; padding: 10px 18px; border-radius: 10px; font-weight:600; cursor:pointer;">OK</button>
            </div>
          </div>
        </div>
      `;
      document.body.appendChild(overlay);

      document.getElementById('popup-ok-btn').addEventListener('click', closePopup);
      document.getElementById('popup-close-x').addEventListener('click', closePopup);
      overlay.addEventListener('click', function(e) { if (e.target === overlay) closePopup(); });
    }

    // Parallax effect on mouse move
    document.addEventListener('mousemove', (e) => {
      const parallaxLayer = document.getElementById('parallaxLayer');
      if (parallaxLayer) {
        const moveX = (e.clientX / window.innerWidth) * 10;
        const moveY = (e.clientY / window.innerHeight) * 10;
        parallaxLayer.style.transform = `translate(${moveX}px, ${moveY}px)`;
      }
    });

    // File input handling
    document.querySelectorAll('input[type="file"]').forEach(input => {
      input.addEventListener('change', (e) => {
        const file = e.target.files[0];
        const button = e.target.parentElement.querySelector('.file-input-button');
        if (file) {
          button.innerHTML = `
            <svg viewBox="0 0 24 24" fill="none"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10,9 9,9 8,9"/></svg>
            ${file.name}
          `;
        }
      });
    });

    // Handle conditional field visibility and work experience management
    document.addEventListener('DOMContentLoaded', function() {
      // Auth modal handlers (if shown)
      const closeAuthBtn = document.getElementById('close-popup');
      const authOverlay = document.getElementById('login-overlay');
      if (closeAuthBtn && authOverlay) {
        closeAuthBtn.addEventListener('click', function(e) { e.preventDefault(); authOverlay.style.display = 'none'; });
      }
      const loginAuthBtn = document.getElementById('login-btn');
      if (loginAuthBtn && authOverlay) {
        loginAuthBtn.addEventListener('click', function(e) { e.preventDefault(); authOverlay.style.display = 'none'; window.location.href = '{% url "login" %}'; });
      }
      const statusInputs = document.querySelectorAll('input[name="status"]');
      const workExperienceSection = document.getElementById('work-experience-section');
      const workEntriesContainer = document.getElementById('work-entries-container');
      const addWorkEntryBtn = document.getElementById('add-work-entry');
      const workExperiencesJson = document.getElementById('work_experiences_json');
      let workExperiences = [];

      function updateFieldVisibility() {
        const selectedStatus = document.querySelector('input[name="status"]:checked');
        if (selectedStatus && selectedStatus.value === 'experienced') {
          workExperienceSection.style.display = 'block';
          if (workExperiences.length === 0) {
            addWorkEntry();
          }
        } else {
          workExperienceSection.style.display = 'none';
          workExperiences = [];
          workEntriesContainer.innerHTML = '';
          workExperiencesJson.value = '[]';
        }
      }

      function renderWorkExperiences() {
        workEntriesContainer.innerHTML = '';
        workExperiences.forEach((exp, index) => {
          const entryDiv = document.createElement('div');
          entryDiv.className = 'work-entry';
          entryDiv.innerHTML = `
            <h4 style="margin-top: 0; color: var(--dark);">Work Experience ${index + 1}</h4>
            <div class="form-group">
              <label class="form-label">Job Title *</label>
              <input type="text" class="form-input job-title" placeholder="e.g., Software Engineer" value="${exp.job_title || ''}" data-index="${index}">
            </div>
            <div class="form-group">
              <label class="form-label">Company Name *</label>
              <input type="text" class="form-input company-name" placeholder="Company name" value="${exp.company_name || ''}" data-index="${index}">
            </div>
            <div class="form-group">
              <label class="form-label">From (Month/Year) *</label>
              <input type="month" class="form-input from-date" value="${exp.from_date || ''}" data-index="${index}">
            </div>
            <div class="form-group">
              <label class="form-label">To (Month/Year)</label>
              <input type="month" class="form-input to-date" placeholder="Leave blank if currently working" value="${exp.to_date || ''}" data-index="${index}">
            </div>
            <div style="display: flex; align-items: center; margin-bottom: 1rem;">
              <input type="checkbox" class="form-check-input currently-working" ${exp.currently_working ? 'checked' : ''} data-index="${index}">
              <label class="form-label" style="margin-bottom: 0; margin-left: 8px;">Currently work here</label>
            </div>
            <div class="form-group">
              <label class="form-label">City</label>
              <input type="text" class="form-input city" placeholder="City" value="${exp.city || ''}" data-index="${index}">
            </div>
            <div class="form-group">
              <label class="form-label">Description of Work</label>
              <textarea class="form-input description" placeholder="Describe your responsibilities and achievements" data-index="${index}" style="resize: vertical; min-height: 100px;">${exp.description || ''}</textarea>
            </div>
            <button type="button" class="btn remove-work-entry" data-index="${index}" style="background-color: #D97706; color: white; border-color: #D97706;">Remove</button>
          `;
          workEntriesContainer.appendChild(entryDiv);
        });

        // Add event listeners
        document.querySelectorAll('.job-title, .company-name, .from-date, .to-date, .city, .description').forEach(input => {
          input.addEventListener('change', updateWorkExperienceData);
        });

        document.querySelectorAll('.currently-working').forEach(checkbox => {
          checkbox.addEventListener('change', function() {
            const index = this.getAttribute('data-index');
            workExperiences[index].currently_working = this.checked;
            if (this.checked) {
              document.querySelector(`.to-date[data-index="${index}"]`).disabled = true;
            } else {
              document.querySelector(`.to-date[data-index="${index}"]`).disabled = false;
            }
            saveWorkExperiences();
          });
        });

        document.querySelectorAll('.remove-work-entry').forEach(btn => {
          btn.addEventListener('click', function(e) {
            e.preventDefault();
            const index = this.getAttribute('data-index');
            workExperiences.splice(index, 1);
            saveWorkExperiences();
            renderWorkExperiences();
          });
        });
      }

      function updateWorkExperienceData(e) {
        const input = e.target;
        const index = input.getAttribute('data-index');
        const fieldName = input.className.split(' ')[1];

        if (fieldName === 'job-title') workExperiences[index].job_title = input.value;
        if (fieldName === 'company-name') workExperiences[index].company_name = input.value;
        if (fieldName === 'from-date') workExperiences[index].from_date = input.value;
        if (fieldName === 'to-date') workExperiences[index].to_date = input.value;
        if (fieldName === 'city') workExperiences[index].city = input.value;
        if (fieldName === 'description') workExperiences[index].description = input.value;

        saveWorkExperiences();
      }

      function saveWorkExperiences() {
        workExperiencesJson.value = JSON.stringify(workExperiences);
      }

      function addWorkEntry() {
        if (workExperiences.length < 3) {
          workExperiences.push({
            job_title: '',
            company_name: '',
            from_date: '',
            to_date: '',
            currently_working: false,
            city: '',
            description: ''
          });
          renderWorkExperiences();
        }
      }

      addWorkEntryBtn.addEventListener('click', function(e) {
        e.preventDefault();
        addWorkEntry();
      });

      // Add event listeners to radio buttons
      statusInputs.forEach(input => {
        input.addEventListener('change', updateFieldVisibility);
      });

      // Initialize on page load
      updateFieldVisibility();

      // AJAX form submission
      var form = document.getElementById('applicationForm');
      var submitBtn = form.querySelector('button[type="submit"]');
      var originalText = submitBtn.textContent;

      form.addEventListener('submit', function(e) {
        e.preventDefault();

        if (submitBtn.disabled) return;
        submitBtn.disabled = true;
        submitBtn.textContent = 'Submitting...';
        submitBtn.style.opacity = '0.7';

        var formData = new FormData(form);

        fetch(form.action || window.location.href, {
          method: 'POST',
          body: formData,
          headers: {
            'X-Requested-With': 'XMLHttpRequest'
          }
        })
        .then(function(response) {
          return response.json().then(function(data) {
            return { ok: response.ok, data: data };
          }).catch(function() {
            return { ok: false, data: { message: 'Server error. Please try again.' } };
          });
        })
        .then(function(result) {
          if (result.ok && result.data.status === 'success') {
            showPopup(true, result.data.message || 'Application submitted successfully!');
            form.reset();
            // Reset work experiences if needed
            workExperiences = [];
            workEntriesContainer.innerHTML = '';
            workExperiencesJson.value = '[]';
            updateFieldVisibility();
          } else {
            showPopup(false, result.data.message || 'Submission failed. Please try again.');
          }
        })
        .catch(function(err) {
          console.error('Submission error:', err);
          showPopup(false, 'Network error. Please check your connection and try again.');
        })
        .finally(function() {
          submitBtn.disabled = false;
          submitBtn.textContent = originalText;
          submitBtn.style.opacity = '1';
        });
      });
    });
  </script>
{% endblock %}
