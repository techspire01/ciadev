=================================================================================
                    LINE REFERENCES - IMPLEMENTATION DETAILS
=================================================================================

FILE: portal/views.py (943 lines total)
─────────────────────────────────────────────────────────────────────────────

FUNCTION: preview_application_file()
  Location: Lines 781-825 (45 lines)
  Purpose: Generate signed URL for previewing PDF/images
  Key Methods:
    - get_supplier_for_user_or_raise() - Get current supplier
    - get_object_or_404() - Get application, validate ownership
    - JsonResponse() - Return signed URL to frontend
  Endpoints Called:
    - /portal-admin/preview/job/<id>/resume/
    - /portal-admin/preview/job/<id>/attachment/
    - /portal-admin/preview/internship/<id>/resume/
    - /portal-admin/preview/internship/<id>/attachment/

FUNCTION: delete_job_applicant()
  Location: Lines 829-920 (91 lines)
  Purpose: Delete job application, resume only, or attachment only
  Key Features:
    - Line 842: Check delete_resume_only flag
    - Line 843: Check delete_attachment_only flag  
    - Line 844: Check if AJAX request
    - Lines 846-873: Handle resume-only deletion
    - Lines 875-902: Handle attachment-only deletion
    - Lines 904-914: Handle full deletion
    - Lines 916-919: Return error or redirect
  Changes Made:
    - Wrapped all storage operations in try-catch
    - Added user messaging via messages.success/error
    - Added logging for audit trail
    - Added JSON response for AJAX requests
    - Added new delete_attachment_only branch

FUNCTION: delete_internship_applicant()
  Location: Lines 923-1014 (91 lines)
  Purpose: Delete internship application, resume only, or attachment only
  Key Features: Identical to delete_job_applicant()
  Parameters:
    - internship_id: which internship posting
    - application_id: which applicant
    - POST['delete_resume_only']: boolean
    - POST['delete_attachment_only']: boolean

─────────────────────────────────────────────────────────────────────────────

FILE: portal/urls.py
─────────────────────────────────────────────────────────────────────────────

NEW URL PATTERN
  Location: Around line 50
  Pattern: portal-admin/preview/<str:application_type>/<int:application_id>/<str:file_type>/
  View: views.preview_application_file
  Name: preview_application_file
  Usage:
    - {% url 'preview_application_file' type=type id=application.id file='resume' %}
    - JavaScript: fetch('/portal-admin/preview/job/1/resume/')

─────────────────────────────────────────────────────────────────────────────

FILE: portal/templates/brand_new_site/applicant_detail.html (600+ lines)
─────────────────────────────────────────────────────────────────────────────

SECTION: Document Section (Reorganized)
  Location: Lines 418-460
  Components:
    Line 428-440: Resume section (preview, download, delete)
    Line 442-460: Attachment section (preview, download, delete)
  Buttons:
    - Line 431: Preview Resume button → onclick="previewFile('resume')"
    - Line 433: Download Resume link → href="{{ application.resume.url }}"
    - Line 436: Delete Resume button → onclick="deleteFile('resume')"
    - Line 449: Preview Attachment → onclick="previewFile('attachment')"
    - Line 451: Download Attachment → href="{{ application.additional_attachment.url }}"
    - Line 454: Delete Attachment → onclick="deleteFile('attachment')"

MODAL: Preview Modal HTML
  Location: Lines 465-469
  ID: previewModal
  Contains:
    - Close button: onclick="closePreview()"
    - iframe: id="previewFrame"
  Styling: Display hidden by default, shows as flex overlay when needed

SECTION: Danger Zone
  Location: Lines 471-481  
  Contains: Only "Delete Entire Application" button
  Button: onclick="deleteApplication()"
  Styling: Purple background with warning icon
  Note: Individual delete buttons moved to document section

SCRIPT: JavaScript Functions
  Location: Lines 502-606 (105 lines)
  
  Function: previewFile(fileType)
    Location: Lines 502-541 (40 lines)
    Logic:
      - Line 503: Get modal and iframe elements
      - Line 505: Show modal in flex mode
      - Line 506: Clear iframe source
      - Lines 509-520: Fetch signed URL from backend
      - Lines 521-536: Display URL in iframe using Google Docs Viewer
      - Lines 537-540: Handle fetch errors
    Call Stack:
      1. User clicks preview button
      2. JavaScript calls previewFile()
      3. Fetch to /portal-admin/preview/TYPE/ID/FILE/
      4. Backend returns {success, url, filename}
      5. JavaScript displays URL in iframe: docs.google.com/gview?url=...
  
  Function: closePreview()
    Location: Lines 544-548 (5 lines)
    Logic:
      - Line 545: Get modal and iframe
      - Line 546: Hide modal
      - Line 547: Clear iframe source
  
  Event Listeners
    Location: Lines 550-567 (18 lines)
    - Lines 550-557: Modal click-outside closes
    - Lines 560-567: Escape key closes
  
  Function: deleteFile(fileType)
    Location: Lines 570-595 (26 lines)
    Logic:
      - Line 571: Get CSRF token
      - Line 572: Get delete endpoint URL
      - Lines 574-577: Build FormData with flags
      - Lines 579-589: Fetch POST request
      - Lines 590-595: Handle response/errors
    Parameters:
      - fileType: 'resume' or 'attachment'
    Flag Logic:
      - If resume: sets delete_resume_only=true
      - If attachment: sets delete_attachment_only=true
  
  Function: deleteApplication()
    Location: Lines 598-606 (9 lines)
    Logic:
      - Similar to deleteFile()
      - No deletion flags (default = delete all)
      - Redirects to applicant list on success

─────────────────────────────────────────────────────────────────────────────

KEY VARIABLES IN JAVASCRIPT
─────────────────────────────────────────────────────────────────────────────

applicationType: 'job' or 'internship'
applicationId: Numeric ID of the application
jobId: ID of job (if job application)
internshipId: ID of internship (if internship application)
csrfToken: {{ csrf_token }} from Django
modal: DOM element with id="previewModal"
frame: DOM element with id="previewFrame"

AJAX REQUEST HEADERS
─────────────────────────────────────────────────────────────────────────────

When sending DELETE requests:
  - X-Requested-With: XMLHttpRequest (tells Django it's AJAX)
  - X-CSRFToken: {{ csrf_token }}
  - Content-Type: application/json or form

Django detects AJAX with:
  - request.headers.get('X-Requested-With') == 'XMLHttpRequest'
  - Returns JsonResponse instead of redirect

=================================================================================
                              QUICK LOOKUP
=================================================================================

Want to...                          Look at...
─────────────────────────────────────────────────────────────────────────────
Change preview timeout              portal/views.py line 818 (signed_url)
Add new file type to preview        portal/views.py line 787-798 (file_type)
Change modal styling                applicant_detail.html line 465
Change preview viewer               applicant_detail.html line 533
Change delete confirmation text     applicant_detail.html line 436, 454, 481
Add custom error handling           portal/views.py line 846, 875, 904
Change redirect after delete        portal/views.py line 919, 1008
Change logging format               portal/views.py line 860, 889, 914

=================================================================================
