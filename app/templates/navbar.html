{% load static %}
{% load custom_filters %}

  <!-- Hidden Google Translate Element -->
  <div id="google_translate_element" style="display: none;"></div>
  <!-- Navbar -->
  <nav class="bg-white border-b border-[#bba99a] fixed-header">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between py-4">
        <!-- Left Side: Login + Search -->
        <div class="flex items-center space-x-4 order-1">
         <!-- Login Button -->
          {% if user.is_authenticated %}
            <!-- Profile Icon with Initials -->
            <div class="relative group">
              <button id="profileBtn" class="w-10 h-10 bg-yellow-600 text-white rounded-full flex items-center justify-center font-bold text-lg focus:outline-none">
                {{ user.get_full_name|default:user.email|slice:":1"|upper }}
              </button>
              <button id="logoutBtn" class="w-10 h-10 bg-red-600 text-white rounded-full flex items-center justify-center font-bold text-lg focus:outline-none transition-all duration-300 hover:bg-red-700 hidden">
                <i class="fas fa-sign-out-alt text-sm"></i>
              </button>
            </div>
          {% else %}
            <a
              href="{% url 'login' %}"
              class="flex items-center space-x-2 text-[#3d2d29] hover:text-yellow-700 px-4 py-2 transition font-medium"
            >
              <i class="fas fa-user"></i>
              <span>Login</span>
            </a>
          {% endif %}
          <!-- Search Bar -->
          <div class="relative hidden md:block">
            <input
              type="text"
              id="searchInput"
              placeholder="Search..!!"
              class="w-40 py-1 px-2 rounded-full text-[#000000] bg-[#FFF9E5] border border-[#000000] shadow-md rounded-full focus:outline-none pr-10 shadow-md search-box"
            />
            <button
              class="absolute right-0 top-0 mt-2 mr-4 text-black hover:text-gray-800"
              title="Search"
            >
              <i class="fas fa-search"></i>
            </button>
            <div id="searchResults" class="absolute top-full left-0 right-0 mt-1 bg-white rounded-md shadow-lg border border-gray-300 z-50 max-h-80 overflow-y-auto hidden"></div>
          </div>
        </div>

        <!-- Center: Logo -->
        <a href="{% url 'index' %}" class="flex items-center space-x-4 order-2 mx-auto px-8">
          <img
            src="{% static 'images/CIA logo.png' %}"
            alt="CIA logo"
            class="h-10 rounded-lg logo-black-filter"
          />
          <span class="text-2xl font-bold text-black">CIA<span class="text-yellow-700">next</span></span>
        </a>

        <!-- Right Side: Navigation + Language - Added margin -->
        <div class="hidden lg:flex items-center space-x-9 order-3 ml-4">
          <a
            href="{% url 'index' %}"
            class="text-[#3d2d29] hover:text-yellow-700 font-medium transition"
            >Home</a>
          <a
            href="{% url 'about' %}"
            class="text-[#3d2d29] hover:text-yellow-700 font-medium transition"
            >About Us</a
          >
          <a
            href="{% url 'category' %}"
            class="text-[#3d2d29] hover:text-yellow-700 font-medium transition"
            >Categories</a>
            <a
            href="{% url 'suppliers' %}"
            class="text-[#3d2d29] hover:text-yellow-700 font-medium transition"
            >Suppliers</a>
          <!-- Language Translation Buttons -->
          <div class="flex items-center space-x-1">
            <button id="translate-en" class="translate-btn px-3 py-1 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition active">EN</button>
            <button id="translate-ta" class="translate-btn px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100 transition">TA</button>
          </div>
        </div>

        <!-- Mobile Menu Button -->
        <div class="lg:hidden order-3 flex items-center space-x-2">
          <button id="mobileMenuBtn" class="relative p-2 text-[#3d2d29] hover:text-yellow-700 transition-all duration-300 focus:outline-none">
            <div class="space-y-1">
              <span class="hamburger-line block w-6 h-0.5 bg-current transition-all duration-300"></span>
              <span class="hamburger-line block w-6 h-0.5 bg-current transition-all duration-300"></span>
              <span class="hamburger-line block w-6 h-0.5 bg-current transition-all duration-300"></span>
            </div>
          </button>
        </div>
      </div>
    </div>

    <!-- Mobile Navigation Menu -->
    <div id="mobileMenu" class="lg:hidden hidden">
      <div class="mobile-panel">
        <!-- Mobile Menu Content -->
        <div class="flex flex-col h-full">
          <div class="flex-1 overflow-y-auto p-4">
            <!-- User Profile Section -->
            <div class="mb-6">
              {% if user.is_authenticated %}
                <div class="flex items-center space-x-3 p-3 bg-yellow-50 rounded-lg">
                  <div class="w-12 h-12 bg-yellow-600 text-white rounded-full flex items-center justify-center font-bold text-lg">
                    {{ user.get_full_name|default:user.email|slice:":1"|upper }}
                  </div>
                  <div class="flex-1">
                    <p class="font-semibold text-gray-800">{{ user.get_full_name|default:user.email }}</p>
                    <p class="text-sm text-gray-600">{{ user.email }}</p>
                  </div>
                </div>
                <div class="mt-3">
                  <a href="{% url 'logout' %}" class="flex items-center space-x-2 w-full px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg transition">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                  </a>
                </div>
              {% else %}
                <a href="{% url 'login' %}" class="flex items-center space-x-2 w-full px-3 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition">
                  <i class="fas fa-user"></i>
                  <span>Login / Sign Up</span>
                </a>
              {% endif %}
            </div>

            <!-- Mobile Search Bar -->
            <div class="relative mb-6">
              <input
                type="text"
                placeholder="Search products, suppliers..."
                class="w-full py-3 px-4 pr-12 rounded-lg text-[#000000] bg-[#FFF9E5] border border-[#bba99a] focus:outline-none focus:ring-2 focus:ring-yellow-500 search-box"
              />
              <button class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-600 hover:text-gray-800">
                <i class="fas fa-search"></i>
              </button>
            </div>

            <!-- Navigation Links -->
            <nav class="space-y-1">
              <a href="{% url 'index' %}" class="flex items-center space-x-3 px-3 py-3 text-[#3d2d29] hover:text-yellow-700 hover:bg-yellow-50 rounded-lg transition">
                <i class="fas fa-home w-5"></i>
                <span class="font-medium">Home</span>
              </a>
              <a href="{% url 'about' %}" class="flex items-center space-x-3 px-3 py-3 text-[#3d2d29] hover:text-yellow-700 hover:bg-yellow-50 rounded-lg transition">
                <i class="fas fa-info-circle w-5"></i>
                <span class="font-medium">About Us</span>
              </a>
              <a href="{% url 'category' %}" class="flex items-center space-x-3 px-3 py-3 text-[#3d2d29] hover:text-yellow-700 hover:bg-yellow-50 rounded-lg transition">
                <i class="fas fa-th-large w-5"></i>
                <span class="font-medium">Categories</span>
              </a>
              <a href="{% url 'suppliers' %}" class="flex items-center space-x-3 px-3 py-3 text-[#3d2d29] hover:text-yellow-700 hover:bg-yellow-50 rounded-lg transition">
                <i class="fas fa-building w-5"></i>
                <span class="font-medium">Suppliers</span>
              </a>

              
          <!-- Mobile Menu Footer -->
          <div class="border-t border-gray-200 p-4">
            <!-- Language Selector -->
            <div class="mb-4">
              <div id="mobileLanguageToggle" class="flex items-center justify-between w-full px-3 py-2 bg-gray-50 rounded-lg hover:bg-gray-100 transition">
                <div class="flex items-center space-x-2">
                  <img src="https://cdn.builder.io/api/v1/image/assets%2F8b4537dd3fc94785bf1c6169a3c80769%2Fe2eef99b80e945699b2f2503b5a83ffa?format=webp&width=800" 
                      alt="Language" 
                      class="w-5 h-5">
                  <span class="font-medium">Language</span>
                </div>
                <!-- Language toggle (desktop version embedded here) -->
                <div class="flex items-center space-x-1">
                  <button id="translate-en-mobile" 
                          class="translate-btn px-3 py-1 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition active">
                    EN
                  </button>
                  <button id="translate-ta-mobile" 
                          class="translate-btn px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100 transition">
                    TA
                  </button>
                </div>
              </div>
            </div>


            <!-- Contact Info -->
            <div class="text-center text-sm text-gray-500">
              <p>&copy; 2025 CIA MachineryHub</p>
              <p>All rights reserved</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Google Translate Setup -->
  <script>
  // Load Google Translate immediately
  (function() {
    const gtScript = document.createElement('script');
    gtScript.src = "//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit";
    document.body.appendChild(gtScript);
  })();

  let translateElement = null;

  function googleTranslateElementInit() {
    translateElement = new google.translate.TranslateElement({
      pageLanguage: 'en',
      includedLanguages: 'en,ta',
      layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
      autoDisplay: false
    }, 'google_translate_element');

    // Wait a bit for the widget to fully initialize
    setTimeout(() => {
      console.log('Google Translate initialized');
    }, 1000);
  }

  // --- LANGUAGE SWITCH LOGIC ---
  function setLanguage(lang) {
    if (translateElement && typeof google !== 'undefined' && google.translate) {
      try {
        // Try to use Google Translate API directly
        const translateInstance = google.translate.TranslateElement.getInstance();
        if (translateInstance) {
          translateInstance.setLang(lang);
          console.log('Language set to:', lang);
          return;
        }
      } catch (e) {
        console.warn('Direct API call failed, using cookie method:', e);
      }
    }

    // Fallback: Set cookies and reload
    const cookieValue = lang === 'en' ? '/en/en' : '/en/' + lang;
    document.cookie = 'googtrans=' + cookieValue + ';path=/;max-age=31536000';
    document.cookie = 'googtrans=' + cookieValue + ';path=/;domain=' + window.location.hostname + ';max-age=31536000';

    // Force reload to apply translation
    setTimeout(() => {
      window.location.reload();
    }, 200);
  }

  function attachTranslateHandlers() {
    const btns = [
      '#translate-en', '#translate-ta',
      '#translate-en-mobile', '#translate-ta-mobile'
    ];
    btns.forEach(id => {
      const el = document.querySelector(id);
      if (el) {
        // Remove existing listeners to avoid duplicates
        el.onclick = null;
        el.addEventListener('click', (e) => {
          e.preventDefault();
          const lang = id.includes('ta') ? 'ta' : 'en';
          console.log('Button clicked:', id, 'Language:', lang);
          setLanguage(lang);
        });
      }
    });
  }

  // run once after DOM ready
  document.addEventListener('DOMContentLoaded', () => {
    // Initial attachment
    attachTranslateHandlers();

    // 🧠 Watch for new buttons in mobile menu after toggle
    const observer = new MutationObserver(() => attachTranslateHandlers());
    observer.observe(document.body, { childList: true, subtree: true });

    // 🕐 re-run binding after mobile menu toggle delay
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    if (mobileMenuBtn) {
      mobileMenuBtn.addEventListener('click', () => {
        setTimeout(attachTranslateHandlers, 400);
      });
    }
  });
  </script>
