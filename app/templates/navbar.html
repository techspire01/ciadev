{% load static %}
{% load custom_filters %}

  <!-- Hidden Google Translate Element -->
  <div id="google_translate_element" style="display: none;"></div>
  <!-- Navbar -->
  <nav class="bg-white border-b border-[#bba99a] fixed-header">
    <div class="container mx-auto px-4">
      <div class="flex items-center justify-between py-4">
        <!-- Left Side: Login + Search -->
        <div class="flex items-center space-x-4 order-1">
         <!-- Login Button -->
          {% if user.is_authenticated %}
            <!-- Profile Icon with Initials -->
            <div class="relative group">
              <a href="{% url 'profile' %}" class="w-10 h-10 bg-yellow-600 text-white rounded-full flex items-center justify-center font-bold text-lg focus:outline-none hover:bg-yellow-700 transition-colors">
                {{ user.get_full_name|default:user.email|slice:":1"|upper }}
              </a>
              <div class="absolute hidden group-hover:block bg-white text-gray-700 mt-2 w-48 rounded shadow-lg z-[9999] border border-gray-200">
                <a href="{% url 'profile' %}" class="block px-4 py-2 hover:bg-yellow-100">
                  <i class="fas fa-user mr-2"></i>Profile
                </a>
                <a href="{% url 'logout' %}" class="block px-4 py-2 hover:bg-red-100 text-red-600">
                  <i class="fas fa-sign-out-alt mr-2"></i>Logout
                </a>
              </div>
            </div>
          {% else %}
            <a
              href="{% url 'login' %}"
              class="flex items-center space-x-2 text-black hover:text-yellow-700 px-4 py-2 transition font-medium"
            >
              <i class="fas fa-user"></i>
              <span>Login</span>
            </a>
          {% endif %}
          <!-- Search Bar -->
          <div class="relative hidden md:block">
            <input
              type="text"
              id="searchInput"
              placeholder="Search..!!"
              class="w-40 py-2 px-3 rounded-full text-[#000000] bg-[#FFF9E5] border-2 border-[#fbbf24] shadow-md focus:outline-none focus:ring-2 focus:ring-yellow-600 focus:border-transparent pr-10 shadow-md search-box"
            />
            <button
              class="absolute right-2 top-1/2 transform -translate-y-1/2 text-yellow-700 hover:text-yellow-800"
              title="Search"
            >
              <i class="fas fa-search"></i>
            </button>
            <div id="searchResults" class="absolute top-full left-0 right-0 mt-1 bg-white rounded-md shadow-lg border border-gray-300 z-60 max-h-80 overflow-y-auto hidden"></div>
          </div>
        </div>

        <!-- Center: Logo -->
        <a href="{% url 'index' %}" class="flex items-center space-x-4 order-2 mx-auto px-8">
          <img
            src="{% static 'images/CIA logo.png' %}"
            alt="CIA logo"
            class="h-10 rounded-lg logo-black-filter"
          />
          <span class="text-2xl font-bold text-black">CIA<span class="text-yellow-700">next</span></span>
        </a>

        <!-- Right Side: Navigation + Language - Added margin -->
        <div class="hidden lg:flex items-center space-x-9 order-3 ml-4">
          <a
            href="{% url 'index' %}"
            class="text-black hover:text-yellow-700 font-medium transition"
            >Home</a>
          <a
            href="{% url 'about' %}"
            class="text-black hover:text-yellow-700 font-medium transition"
            >About Us</a
          >
          <a
            href="{% url 'category' %}"
            class="text-black hover:text-yellow-700 font-medium transition"
            >Categories</a>
            <a
            href="{% url 'suppliers' %}"
            class="text-black hover:text-yellow-700 font-medium transition"
            >Suppliers</a>
          <!-- Language Translation Buttons -->
          <div class="flex items-center space-x-1">
            <button id="translate-en" class="translate-btn px-3 py-1 text-sm font-medium text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200 transition active">EN</button>
            <button id="translate-ta" class="translate-btn px-3 py-1 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-100 transition">TA</button>
          </div>
        </div>

        <!-- Mobile Menu Button -->
        <div class="lg:hidden order-3 flex items-center space-x-2">
          <button id="mobileMenuBtn" class="relative p-2 text-black hover:text-yellow-700 transition-all duration-300 focus:outline-none">
            <div class="space-y-1">
              <span class="hamburger-line block w-6 h-0.5 bg-current transition-all duration-300"></span>
              <span class="hamburger-line block w-6 h-0.5 bg-current transition-all duration-300"></span>
              <span class="hamburger-line block w-6 h-0.5 bg-current transition-all duration-300"></span>
            </div>
          </button>
        </div>
      </div>
    </div>

  <!-- Google Translate Setup -->
  <script>
  // Load Google Translate immediately
  (function() {
    const gtScript = document.createElement('script');
    gtScript.src = "//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit";
    document.body.appendChild(gtScript);
  })();

  let translateElement = null;

  function googleTranslateElementInit() {
    translateElement = new google.translate.TranslateElement({
      pageLanguage: 'en',
      includedLanguages: 'en,ta',
      layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
      autoDisplay: false
    }, 'google_translate_element');

    // Wait a bit for the widget to fully initialize
    setTimeout(() => {
      console.log('Google Translate initialized');
    }, 1000);
  }

  // --- LANGUAGE SWITCH LOGIC ---
  function setLanguage(lang) {
    if (translateElement && typeof google !== 'undefined' && google.translate) {
      try {
        // Try to use Google Translate API directly
        const translateInstance = google.translate.TranslateElement.getInstance();
        if (translateInstance) {
          translateInstance.setLang(lang);
          console.log('Language set to:', lang);
          return;
        }
      } catch (e) {
        console.warn('Direct API call failed, using cookie method:', e);
      }
    }

    // Fallback: Set cookies and reload
    const cookieValue = lang === 'en' ? '/en/en' : '/en/' + lang;
    document.cookie = 'googtrans=' + cookieValue + ';path=/;max-age=31536000';
    document.cookie = 'googtrans=' + cookieValue + ';path=/;domain=' + window.location.hostname + ';max-age=31536000';

    // Force reload to apply translation
    setTimeout(() => {
      window.location.reload();
    }, 200);
  }

  function attachTranslateHandlers() {
    const btns = [
      '#translate-en', '#translate-ta',
      '#translate-en-mobile', '#translate-ta-mobile'
    ];
    btns.forEach(id => {
      const el = document.querySelector(id);
      if (el) {
        // Remove existing listeners to avoid duplicates
        el.onclick = null;
        el.addEventListener('click', (e) => {
          e.preventDefault();
          const lang = id.includes('ta') ? 'ta' : 'en';
          console.log('Button clicked:', id, 'Language:', lang);
          setLanguage(lang);
        });
      }
    });
  }

  // run once after DOM ready
  document.addEventListener('DOMContentLoaded', () => {
    // Initial attachment
    attachTranslateHandlers();

    // ðŸ§  Watch for new buttons in mobile menu after toggle
    const observer = new MutationObserver(() => attachTranslateHandlers());
    observer.observe(document.body, { childList: true, subtree: true });

    // ðŸ• re-run binding after mobile menu toggle delay
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    if (mobileMenuBtn) {
      mobileMenuBtn.addEventListener('click', () => {
        setTimeout(attachTranslateHandlers, 400);
      });
    }
  });
  </script>
